---
title: "Top 10 Mortality Causes of South Korea of the years 2000, 2010, 2015, 2019"
subtitle: "Poisson and Negative Bionimal Modelling of Annual Death Number and Cause"
author: 
  - Hyuk Jang
thanks: "Code and data are available at: https://github.com/anggimude/Top-Mortality-Causes-of-South-Korea"
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r setup}
#| echo: false
#| message: false
#| warning: false

#### Work space setup ####

library(tidyverse)
library(dplyr)
library(rstanarm)
library(ggplot2)
library(modelsummary)
library(bayesplot)
library(parameters)
library(broom)
library(kableExtra)
library(gt)
library(readr)
library(broom.mixed)

# Read data

all_data <- read_csv("/Users/hyukjang/Top Mortality Causes South Korea//starter_folder-main/data/cleaned_data/all_data.csv")
intersect_all_data <- read_csv("/Users/hyukjang/Top Mortality Causes South Korea/starter_folder-main/data/cleaned_data/intersect_all_data.csv")

```


# Introduction



The remainder of this paper is structured as follows. @sec-data....



# Data {#sec-data}

## Raw Data

## Cleaned Data


Some of our data is of penguins (@fig-bills), from @palmerpenguins.

```{r}
#| label: all_data
#| tbl-cap: Top 10 Mortality Rates of South Korea 
#| echo: false

head(all_data, n =40) |>
  kable(
    col.names = c("Year", "Cause", "Deaths", "Death Rate", "Ranking"),
    align = c("l", "r", "r", "r", "r"),
    digits = 0, booktabs = TRUE, linesep = ""
  )
```

Talk more about it.

And also planes (@fig-planes). (You can change the height and width, but don't worry about doing that until you have finished every other aspect of the paper - Quarto will try to make it look nice and the defaults usually work well once you have enough text.)


```{r}
#| label: intersect_all_data
#| fig-cap: Common Mortality Causes of All Four Years 2000, 2010, 2015, 2019
#| echo: false
#| warning: false
#| message: false

head(intersect_all_data, n = 24) |>
  kable(
    col.names = c("Year", "Cause", "Deaths"),
    align = c("l", "r", "r"),
    digits = 0, booktabs = TRUE, linesep = ""
  )
```

```{r}
#| label: intersect_all_data_graph
#| fig-cap: Line Graph of Common Mortality Causes of South Korea
#| echo: false

intersect_all_data|>
  ggplot(aes(x = Year, y = Deaths, color = Cause)) +
  geom_line() +
  ggtitle("Common Mortality Causes") +
  xlab("Year") +
  ylab("Annual Number of Deaths in South Korea") +
  theme_minimal() +
  scale_x_continuous(breaks = unique(intersect_all_data$Year)) +
  theme_minimal()

```
Talk way more about it. 

## Basic Summary Statistics

```{r}
#| echo: false
#| eval: true
#| label: tbl-sumsta_korea
#| tbl-cap: "Summary statistics of the number of yearly deaths, by cause, in South Korea"

datasummary(
  Deaths ~ Min + Mean + Max + SD + Var + N,
  fmt = 0,
  data = intersect_all_data
)
```

# Model

The goal of our modelling strategy is twofold. Firstly,...

Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in [Appendix -@sec-model-details].

## Model set-up

Define $y_i$ as the number of seconds that the plane remained aloft. Then $\beta_i$ is the wing width and $\gamma_i$ is the wing length, both measured in millimeters.  





\begin{align} 
y_i|\mu_i, \sigma &\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &= \alpha + \beta_i + \gamma_i\\
\alpha &\sim \mbox{Normal}(0, 2.5) \\
\beta &\sim \mbox{Normal}(0, 2.5) \\
\gamma &\sim \mbox{Normal}(0, 2.5) \\
\sigma &\sim \mbox{Exponential}(1)
\end{align}

We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.


### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| label: poissonsumamrymodel
#| tbl-cap: "Poisson model of most prevalent cause of deaths in South Korea 2000, 2010, 2015, 2019"


cause_of_death_south_korea_poisson <- readRDS("/Users/hyukjang/Top Mortality Causes South Korea/starter_folder-main/models/cause_of_death_south_korea_poisson.rds")

coef_short_names <-
  c("(Intercept)" = "Intercept",
    "CauseLiver cancer" = "Liver Cancer",
    "CauseSelf-harm" = "Self Harm",
    "CauseStomach cancer" = "Stomach Cancer",
    "CauseStroke" = "Stroke",
    "CauseTrachea, bronchus, lung cancers" = "Trachea, Bronchus, Lung Cancer"
  )

modelsummary(
  list(
    "Poisson" = cause_of_death_south_korea_poisson
  ),
  coef_map = coef_short_names
)

```


```{r}
#| echo: false
#| eval: true
#| label: negbinsumamrymodel
#| tbl-cap: "Negative Binomial model of most prevalent cause of deaths in South Korea 2000, 2010, 2015, 2019"

cause_of_death_south_korea_neg_binomial <- readRDS("/Users/hyukjang/Top Mortality Causes South Korea/starter_folder-main/models/cause_of_death_south_korea_neg_binomial.rds")

coef_short_names <-
  c("(Intercept)" = "Intercept",
    "CauseLiver cancer" = "Liver Cancer",
    "CauseSelf-harm" = "Self Harm",
    "CauseStomach cancer" = "Stomach Cancer",
    "CauseStroke" = "Stroke",
    "CauseTrachea, bronchus, lung cancers" = "Trachea, Bronchus, Lung Cancer"
  )

modelsummary(
  list(
    "Negative Binomial" = cause_of_death_south_korea_neg_binomial
  ),
  coef_map = coef_short_names
)

```


```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

pp_check(cause_of_death_south_korea_poisson) +
  theme(legend.position = "bottom")

pp_check(cause_of_death_south_korea_neg_binomial) +
  theme(legend.position = "bottom")
```

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

poisson <- loo(cause_of_death_south_korea_poisson, cores = 2)
neg_binomial <- loo(cause_of_death_south_korea_neg_binomial, cores = 2)

loo_compare(poisson, neg_binomial)
```

# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 



## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...





\newpage


# References


