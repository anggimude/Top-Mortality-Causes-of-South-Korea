---
title: "Top 10 Mortality Causes for Republic of Korea of the years 2000, 2010, 2015, 2019"
subtitle: "Poisson and Negative Bionimal Modelling of Annual Death Number and Cause"
author: 
  - Hyuk Jang
thanks: "Code and data are available at: https://github.com/anggimude/Top-Mortality-Causes-of-South-Korea"
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
toc: true
output:
  bookdown::pdf_document2
bibliography: references.bib
---

```{r setup}
#| echo: false
#| message: false
#| warning: false

#### Work space setup ####

library(tidyverse)
library(dplyr)
library(rstanarm)
library(ggplot2)
library(modelsummary)
library(bayesplot)
library(parameters)
library(broom)
library(kableExtra)
library(gt)
library(readr)
library(broom.mixed)

# Read data

all_data <- read_csv("~/Top Mortality Causes South Korea/data/cleaned_data/all_data.csv")
intersect_all_data <- read_csv("~/Top Mortality Causes South Korea/data/cleaned_data/intersect_all_data.csv")

```

\newpage

# Introduction

The remainder of this paper is structured as follows. @sec-data....

# Data {#sec-data}

## Raw Data

The data used in this paper is derived from WHO(WHO) and was downloaded from the WHO Mortality Database. WHO(WHO) provides data for years country-level Global Health Estimates(GHE2019) for the years 2000-2019. Because the years that have estimates of a list provided of the cause of death categories in terms of International Classification of Diseases, Tenth Revision(ICD-10) in terms of a summary table of number of deaths by cause, age, and sex for WHO(WHO) member states for the years are 2000, 2010, 2015, 2019; the data for these four years are cleaned and analyzed for this paper. The analysis of deaths by cause of the raw data is executed for the age groups from 5 to 85+. This paper looks into the data for Republic of Korea as the author is South Korean but also because WHO methods and data sources(citation) certifies a high quality of data. The raw data includes columns such as code, cause, IS03, year, sex, age group, population, deaths, death rate per 100000 population, DALY, DALY rate per 100000 population.

The cleaning, testing, and modelling of the data for this paper was done through R [@citeR] with the aid of the following packages: tidyverse [@citetidyverse], dplyr [@citedplyr], rstanarm [@citerstanarm], ggplot2 [@citeggplot2], modelsummary [@citemodelsummary], bayesplot [@citebayesplot], parameters [@citeparameters], broom [@citebroom], kableExtra [@citekableExtra], gt [@citegt], readr [@citereadr], broom.mixed [@citebroommixed].

## Cleaned Data

The data that is needed for this paper is year, cause, and number of deaths, so the raw data is cleaned to contain only the three columns we need. Because we are looking into the top 10 mortality in this paper, we rank the causes based on its number of deaths and merge it into @tbl-all_data_one. Now that the cleaning is done we can see the top 10 causes of deaths for the years 2000, 2010, 2015, and 2019, however, this isn't enough because to make a graph and create a poisson and negative binomial model, we must find the causes that are common in all of the years. @tbl-intersect_data_one represents the table in which only the causes that appear among all the years descending order of ranking. Now we can recognize the six main causes of death in South Korea is stroke, Ischaemic Heart Disease, Stomach Cancer, Trachea Bronchus Lung Cancer, Liver Cancer, and Self Harm. Looking at @fig-intersect_all_data_graph, we can see some interesting trends. For example, there is a plunge in the annual number of deaths from stroke over the 9 year span. On the other hand, there has been increases for the causes of Ischaemic heart disease and Trachea, Bronchus, Lung cancer. There is a slight decrease in stomach cancer while liver cancer didn't fluctuate as much. Self harm is interesting because Korea is known to have the highest suicide rates out of all the OECD countries(Citation), and we see an increase in the number deaths from self harm has increased rapidly from 2000 to 2010 and a small decrease from 2010 to 2015. It seems like the death numbers from self harm has plateaued with a very slow rate of increase. In general, the top 10 most common causes of deaths are stroke, heart disease, stomach cancer, lung cancer, road injury, liver cancer, diabetes, Cirrhosis of the liver(liver damage), and self harm.

```{r}
#| label: tbl-all_data_one
#| tbl-cap: Top 10 Mortality Rates of South Korea 
#| echo: false
#| warning: false

head(all_data, n =40) |>
  kable(
    col.names = c("Year", "Cause", "Deaths", "Death Rate", "Ranking"),
    align = c("l", "r", "r", "r", "r"),
    digits = 0, booktabs = TRUE, linesep = ""
  )
```

```{r}
#| label: tbl-intersect_data_one
#| tbl-cap: Common Mortality Causes of All Four Years 2000, 2010, 2015, 2019
#| echo: false
#| warning: false
#| message: false

head(intersect_all_data, n = 24) |>
  kable(
    col.names = c("Year", "Cause", "Deaths"),
    align = c("l", "r", "r"),
    digits = 0, booktabs = TRUE, linesep = ""
  )
```

```{r}
#| label: fig-intersect_all_data_graph
#| fig-cap: Line Graph of Common Mortality Causes of South Korea
#| echo: false

intersect_all_data|>
  ggplot(aes(x = Year, y = Deaths, color = Cause)) +
  geom_line() +
  ggtitle("Common Mortality Causes") +
  xlab("Year") +
  ylab("Annual Number of Deaths in South Korea") +
  theme_minimal() +
  scale_x_continuous(breaks = unique(intersect_all_data$Year)) +
  theme_minimal()

```

## Basic Summary Statistics

@tbl-sumsta_korea is a representation of the @tbl-intersect_data_one showing its minimum, mean, maximum, standard deviation, variance, and sample size. The summary statistics shows that the mean of the number of deaths are 18320, with a minimum of 6860, and a maximum of 44109 for a sample size of 24 as the data selected is from @tbl-intersect_data_one. The standard deviation and variance may be abnormally high because the range of the data is large, in other words, because the mean is 18320, and the maximum is 44109, there is likely a few outliers in the data creating such a high standard deviation and variance.


```{r}
#| echo: false
#| eval: true
#| label: tbl-sumsta_korea
#| tbl-cap: "Summary statistics of the number of yearly deaths, by cause, in South Korea"


datasummary(
  Deaths ~ Min + Mean + Max + SD + Var + N,
  fmt = 0,
  data = intersect_all_data
)
```


# Model

The goal the Bayesian model is to incorporate prior knowledge such as previous studies or analysis into the choice of model. In this paper we use poisson and negative binomial model because both of these models is often used when there occurs a certain number of events in a certain time period or intervals. The poisson distribution is efficient when used for situations where events occur independently over intervals of time. The data represents the cause and the annual number of death for the selected years, the poisson distribution is a measure that is appropriate. However, the poisson distribution is not the perfect fit because it assumes that the mean and the variance are the same whilst @tbl-sumsta_korea shows us there is a significant difference in the mean and standard deviation. Negative binomial distribution is a perfect for situations like this. The negative binomial distribution accounts for additional variability when the data shows evidence of over dispersion. In addition, the negative binomial distribution has an extra parameter that considers the variance being larger than the mean. Thus, executing both models and comparing the results will determine the goodness of the fit.

## Model set-up

The two models that are used in this paper are poisson and negative binomial which are both run in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`. Both models define $y_i$ as the number of deaths to a specific cause. For the poisson model it is followed by the mean parameter $\gamma_i$. The mean parameter $\gamma_i$ is modeled as an exponential of a linear combination of the intercept $\alpha_i$, regression coefficient $\beta_i$ where $i$ is the predictor, and an extra coefficient $\gamma_i$. All three $\alpha_i$, $\beta_i$, and $\gamma_i$ follows a normal distribution with mean 0 and standard deviation of 2.5 as the prior. The negative Binomial model has a mean parameter $\mu_i$ and a dispersion parameter $\phi$. $\mu_i$ is modeled as the exponential of a lienar combination of an intercept $\alpha_i$, coefficients $\beta_i$ which represents the effects of each cause on the number of deaths, and $\gamma_i$ will account for any extra variability in our scenario. The intercept $\alpha_i$ and coefficient of cause $\beta_i$ follow a normal distribution with mean 0 and a standard deviation of 2.5. The dispersion parameter $\phi$ follows an exponential distribution with a rate parameter of 1. In summary, both poisson and negative binomial models work towards predicting the number of deaths based on the different causes assuming each cause has a coefficient affecting the number of deaths.

```{=tex}
\begin{align}
y_i &\sim \text{Poisson}(\lambda_i) \quad \text{(1)} \\
\lambda_i &= \exp(\alpha + \beta_i + \gamma_i) \quad \text{(2)} \\
\alpha &\sim \text{Normal}(0, 2.5) \quad \text{(3)} \\
\beta_i &\sim \text{Normal}(0, 2.5) \quad \text{(4)} \\
\gamma_i &\sim \text{Normal}(0, 2.5) \quad \text{(5)} \\
\end{align}
```
```{=tex}
\begin{align}
y_i &\sim \text{NegBinomial}(\mu_i, \phi) \quad \text{(1)} \\
\mu_i &= \exp(\alpha + \beta_i + \gamma_i) \quad \text{(2)} \\
\alpha &\sim \text{Normal}(0, 2.5) \quad \text{(3)} \\
\beta_i &\sim \text{Normal}(0, 2.5) \quad \text{(4)} \\
\gamma_i &\sim \text{Normal}(0, 2.5) \quad \text{(5)} \\
\phi &\sim \text{Exponential}(1) \quad \text{(6)}
\end{align}
```


## Model justification

Applying the information from @tbl-intersect_data_one, it is difficult to generalize whether there would be a positive or negative correlation between the number of deaths and its cause. This is because every year there is a different number of deaths from the same cause. For example, from @fig-intersect_all_data_graph, we can expect that stroke would have negative correlation coefficient because the annual number of deaths has decreased significantly over the 9 years period. On the other hand, we may predict a positive correlation coefficient for the causes like heart disease and lung cancer as they have been showing an increase trend in the number of deaths since 2000 to 2019. It may be difficult to exactly predict how self harm, liver cancer, and stomach cancer without the actual calculations being done due to the ambiguity the data shows.


# Results
## Overview of models

Our results are summarized in @tbl-poisson_sum_model and @tbl-neg_bin_sum_model. We are primarily interested how each cause of death correlates to the annual number of deaths in South Korea. The two models provides us with th estimates for the intercept and coefficient for the causes such as liver cancer, self harm, stomach cancer, stroke, and trachea bronchus lung cancer. The intercept represents the expected log count of deaths when the cause variable is zero. However, with our data set, the cause variable cannot be zero, which makes the interpretation of this quite unclear. The coefficients for the different causes imply the log rate ratio for each cause compared to the reference category. In other words, the coefficient shows the rate at which each cause effects the log count of deaths. Num.Obs represents the number of observations made in the model, Log.lik is the log-likelihood measuring the fitness of the model, where the lower, the better fit it is. ELPD and ELPD s.e. explains the log predictive density and its standard error. LOOIC is an acronym for leave-one-out information criterion which is a measure of model fit. Lower values are better, and the standard error shows the uncertainty of the estimate. WAIC stands for watanabe-akaike information criterion which is another measure of good fit; lower values are better fit. RMSE is the room mean squared error measuring the model's predictive performance where the lower values mean more accurate predicts. 


## Poisson model results

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| label: tbl-poisson_sum_model
#| tbl-cap: "Poisson model of most prevalent cause of deaths in South Korea 2000, 2010, 2015, 2019"

cause_of_death_south_korea_poisson <- readRDS("~/Top Mortality Causes South Korea/models/cause_of_death_south_korea_poisson.rds")

coef_short_names <-
  c("(Intercept)" = "Intercept",
    "CauseLiver cancer" = "Liver Cancer",
    "CauseSelf-harm" = "Self Harm",
    "CauseStomach cancer" = "Stomach Cancer",
    "CauseStroke" = "Stroke",
    "CauseTrachea, bronchus, lung cancers" = "Trachea, Bronchus, Lung Cancer"
  )

modelsummary(
  list(
    "Poisson" = cause_of_death_south_korea_poisson
  ),
  coef_map = coef_short_names
)

```


@tbl-poisson_sum_model represents the summary of the poisson model. It has an intercept of 10.105 which we can interpret as there will be 10 deaths annually from other factors. Stomach and liver cancer display a strong negative correlation coefficient each -0.826, and -0.736 respectively. Self harm also has a quite strong negative correlation coefficient -0.621. This implies that the model predicts that there will be a decrease in the log count of deaths for these causes, in short, there will be a decrease in the annual number of deaths for causes with a negative correlation coefficient when all else is held the same. Trachea, bronchus, lung cancer has a relatively weaker negative coefficient compared to the other causes mentioned above but it is not a negligible number -0.349. Stroke is interesting because from @fig-intersect_all_data_graph, we expected the coefficient to be strongly negative but it turns out to be slightly positive 0.286. For an unknown reason, the model is predicting that there will be an increase in the annual number of deaths from stroke in the near future. The poisson model has a very low log likelihood of -8157.665 implying the model may be a good fit. However, when we look at the values for LOOIC, WAIC, and RMSE, the values are extremely high each 17671.3, 22572.8, and 3830.21 which makes this model results quite unreliable. 


## Negative binomial model results

```{r}
#| echo: false
#| eval: true
#| label: tbl-neg_bin_sum_model
#| tbl-cap: "Negative Binomial model of most prevalent cause of deaths in South Korea 2000, 2010, 2015, 2019"

cause_of_death_south_korea_neg_binomial <- readRDS("~/Top Mortality Causes South Korea/models/cause_of_death_south_korea_neg_binomial.rds")

coef_short_names <-
  c("(Intercept)" = "Intercept",
    "CauseLiver cancer" = "Liver Cancer",
    "CauseSelf-harm" = "Self Harm",
    "CauseStomach cancer" = "Stomach Cancer",
    "CauseStroke" = "Stroke",
    "CauseTrachea, bronchus, lung cancers" = "Trachea, Bronchus, Lung Cancer"
  )

modelsummary(
  list(
    "Negative Binomial" = cause_of_death_south_korea_neg_binomial
  ),
  coef_map = coef_short_names
)

```


@tbl-neg_bin_sum_model displays the results of the negative binomial test. Looking into the results, there is one thing different compared to what saw from @tbl-poisson_sum_model. The negative binomial model includes the standard error in parentheses which indicates uncertainty or variability and smaller standard error implies more precision. The intercept is 10.102 with a standard error of 0.190 suggesting the intercept is accurate. Liver cancer, self harm, stomach cancer, and trachea bronchus lung cancer is showing a negative correlation coefficient each of which is -0.726, -0.610, -0.814, and -0.314. Each has a standard error of 0.266, 0.268, 0.276, 0.272. Liver cancer, self harm, and stomach cancer exhibit the strongest negative correlation coefficient in which we can interpret as in the future, there will be a significant decrease in the number of deaths from these causes if all else is equal. Trachea, bronchus, lung cancer show a relatively weaker correlation coefficient which implies that it is likely that there will be a small decrease in the number of deaths in the future. Stroke is the only cause that has a positive correlation coefficient 0.296 with a standard error of 0.274. We can say that there is a high probability that there will be a slight increase in the number of deaths caused by stroke in the future. The log likelihood is -237.44 suggesting the results of this model is accurate. The LOOIC and WAIC are relatively lower than the ones from @tbl-poisson_sum_model encourages that the negative binomial model is a better fit than the poisson model. Since the RMSE is quite similar, we can think that the negative binomial model is a better fit than the poisson model which makes the results from the negative binomial more accurate. 


## Model results summary

Comparing the values of the two data sets, and the goodness of fit of the models, we can confirm the validity of our model results. Looking at the two values we from each model for each cause, all causes are in very close proximity. Through this we can see that the results from @tbl-poisson_sum_model and @tbl-neg_bin_sum_model are credible. Thus, we can confidently say that liver cancer has a negative correlation coefficient of -0.73, self harm's coefficient is around -0.61, stomach cancer is around -0.82, stroke is around 0.29, lung cancer is around -0.341 all of which have a standard error around 0.27. These results suggest that the model estimates that liver cancer, self harm, stomach cancer, and lung cancer will have a decrease in the log number of deaths while stroke will have an increase in the log number of deaths.


## Other model results

@fig-ppcheck_posterior is posterior predictive check and @fig-loo_check is a leave-one-out cross validation. These will be further discussed in @sec-posterior_check.

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheck_posterior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]
#| fig-pos: "h"

pp_check(cause_of_death_south_korea_poisson) +
  theme(legend.position = "bottom")

pp_check(cause_of_death_south_korea_neg_binomial) +
  theme(legend.position = "bottom")
```


```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-loo_check
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2
#| fig-pos: "h"

poisson <- loo(cause_of_death_south_korea_poisson, cores = 2)
neg_binomial <- loo(cause_of_death_south_korea_neg_binomial, cores = 2)

loo_compare(poisson, neg_binomial)
```

# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this.

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {.unnumbered}

# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check {#sec-posterior_check}

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows...

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

\newpage

# References
